<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: r3waypoints.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: r3waypoints.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const EARTH_RADIUS_NM = 3440.065; // Rayon moyen de la Terre en milles nautiques
const DEG2RAD = Math.PI / 180;
const RAD2DEG = 180 / Math.PI;

/**
 * Computes the initial orthodromic (great-circle) bearing from one point to another.
 *
 * This function calculates the initial heading (bearing) in degrees required 
 * to travel from the first point (`prev`) to the second (`curr`) along a great-circle route.
 * 
 * @param {Array&lt;number>} prev - The starting point as an array [latitude, longitude] in degrees.
 * @param {Array&lt;number>} curr - The destination point as an array [latitude, longitude] in degrees.
 * @returns {number} The initial bearing in degrees, ranging from 0 to 360°.
 */
function orthoCap (prev, curr) {
   if ((curr === undefined) || (prev === undefined)) return 0;
   // Conversion des degrés en radians
   const toRadians = deg => deg * Math.PI / 180;
   const toDegrees = rad => rad * 180 / Math.PI;
    
   const lat1 = toRadians(prev[0]);
   const lon1 = toRadians(prev[1]);
   const lat2 = toRadians(curr[0]);
   const lon2 = toRadians(curr[1]);

   const dLon = lon2 - lon1;

   // Formule de calcul du cap initial (bearing) en radians
   const y = Math.sin(dLon) * Math.cos(lat2);
   const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
   const heading = Math.atan2(y, x);

   return (toDegrees (heading) + 360) % 360;
}

/**
 * Calculates the orthodromic (great-circle) distance between two points.
 *
 * @param {Array&lt;number>} prev - Starting point [latitude, longitude] in degrees.
 * @param {Array&lt;number>} curr - Destination point [latitude, longitude] in degrees.
 * @returns {number} Distance in nautical miles.
 */
function orthoDist (prev, curr) {
  if ((curr === undefined) || (prev === undefined)) return 0;
  const [lat1, lon1] = prev.map(deg => deg * DEG2RAD);
  const [lat2, lon2] = curr.map(deg => deg * DEG2RAD);

  const deltaSigma = Math.acos(
    Math.sin(lat1) * Math.sin(lat2) +
    Math.cos(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1)
  );

  return EARTH_RADIUS_NM * deltaSigma;
}

/**
 * Computes the initial loxodromic (rhumb line) bearing from one point to another.
 *
 * @param {Array&lt;number>} prev - Starting point [latitude, longitude] in degrees.
 * @param {Array&lt;number>} curr - Destination point [latitude, longitude] in degrees.
 * @returns {number} Initial bearing in degrees from 0 to 360.
 */
function loxoCap (prev, curr) {
  if ((curr === undefined) || (prev === undefined)) return 0;
  const [lat1, lon1] = prev.map(deg => deg * DEG2RAD);
  const [lat2, lon2] = curr.map(deg => deg * DEG2RAD);
  let dLon = lon2 - lon1;

  const dPhi = Math.log(Math.tan(Math.PI / 4 + lat2 / 2) / Math.tan(Math.PI / 4 + lat1 / 2));

  // Corriger dLon pour franchissement de l'antiméridien
  if (Math.abs(dLon) > Math.PI) {
    dLon = dLon > 0 ? -(2 * Math.PI - dLon) : (2 * Math.PI + dLon);
  }

  let bearing = Math.atan2(dLon, dPhi) * RAD2DEG;
  return (bearing + 360) % 360;
}

/**
 * Calculates the loxodromic (rhumb line) distance between two points.
 *
 * @param {Array&lt;number>} prev - Starting point [latitude, longitude] in degrees.
 * @param {Array&lt;number>} curr - Destination point [latitude, longitude] in degrees.
 * @returns {number} Distance in nautical miles.
 */
function loxoDist (prev, curr) {
  if ((curr === undefined) || (prev === undefined)) return 0;
  const [lat1, lon1] = prev.map(deg => deg * DEG2RAD);
  const [lat2, lon2] = curr.map(deg => deg * DEG2RAD);
  let dLon = Math.abs(lon2 - lon1);
  const dLat = lat2 - lat1;

  const dPhi = Math.log(Math.tan(Math.PI / 4 + lat2 / 2) / Math.tan(Math.PI / 4 + lat1 / 2));

  const q = Math.abs(dPhi) > 1e-12 ? dLat / dPhi : Math.cos(lat1);

  // Corriger dLon pour franchissement de l'antiméridien
  if (dLon > Math.PI) {
    dLon = 2 * Math.PI - dLon;
  }

  const distance = Math.sqrt(dLat * dLat + q * q * dLon * dLon);
  return EARTH_RADIUS_NM * distance;
}

/**
 * Displays waypoints and computed distances/courses for each competitor.
 *
 * For each competitor, this function builds a table that includes, for each leg between waypoints:
 * the index, lat/lon, orthodromic course and distance, and loxodromic course and distance.
 * Totals for distances are shown at the bottom in bold red.
 *
 * @param {Array&lt;Object>} competitors - Array of competitors, each having at least `name`, `lat`, `lon`.
 * @param {Array&lt;Array&lt;number>>} wayPoints - Array of waypoints, each being [lat, lon].
 */
function displayWayPoints(competitors, wayPoints) {
   if (!Array.isArray(wayPoints) || wayPoints.length === 0) {
      Swal.fire({
         icon: "warning",
         title: "No waypoint defined",
         text: "Please define at least one waypoint before displaying data.",
      });
      return;
   }

   const container = document.createElement("div");

   competitors.forEach((competitor, index) => {
      const wrapper = document.createElement("div");
      wrapper.style.border = "1px solid #ccc";
      wrapper.style.borderRadius = "8px";
      wrapper.style.padding = "10px";
      wrapper.style.margin = "0 10px 20px 10px"; // marges gauche/droite
      wrapper.style.backgroundColor = "#f9f9f9";

      const table = document.createElement("table");
      table.style.borderCollapse = "collapse";
      table.style.width = "100%";
      table.style.textAlign = "right"; // alignement des nombres à droite
      table.style.margin = "auto";

      const caption = document.createElement("caption");
      caption.textContent = competitor.name;
      caption.style.fontWeight = "bold";
      caption.style.fontSize = "1.2em";
      caption.style.marginBottom = "0.5em";
      table.appendChild(caption);

      const thead = document.createElement("thead");
      thead.innerHTML = `
         &lt;tr>
            &lt;th style="text-align:left;">Waypoint&lt;/th>
            &lt;th>Coord.&lt;/th>
            &lt;th>Ortho Cap (°)&lt;/th>
            &lt;th>Ortho Dist (NM)&lt;/th>
            &lt;th>Loxo Cap (°)&lt;/th>
            &lt;th>Loxo Dist (NM)&lt;/th>
         &lt;/tr>`;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      let totalOrtho = 0;
      let totalLoxo = 0;
      let copyText = "Waypoint\tCoord.\tOrtho Cap (°)\tOrtho Dist (NM)\tLoxo Cap (°)\tLoxo Dist (NM)\n";

      let prev = [competitor.lat, competitor.lon];
      for (let i = 0; i &lt; wayPoints.length; i++) {
         const curr = wayPoints[i];
         const strCoord = toDMSString (curr [0], curr [1]);
         const orthoC = orthoCap(prev, curr).toFixed(1);
         const orthoD = orthoDist(prev, curr).toFixed(2);
         const loxoC = loxoCap(prev, curr).toFixed(1);
         const loxoD = loxoDist(prev, curr).toFixed(2);

         totalOrtho += parseFloat(orthoD);
         totalLoxo += parseFloat(loxoD);

         const label = (i === wayPoints.length - 1) ? "Dest." : i;
         const row = document.createElement("tr");
         row.innerHTML = `
            &lt;td style="text-align:left;">${label}&lt;/td>
            &lt;td>${strCoord}&lt;/td>
            &lt;td>${orthoC}&lt;/td>
            &lt;td>${orthoD}&lt;/td>
            &lt;td>${loxoC}&lt;/td>
            &lt;td>${loxoD}&lt;/td>`;
         tbody.appendChild(row);

         copyText += `${label}\t${strCoord}\t${orthoC}\t${orthoD}\t${loxoC}\t${loxoD}\n`;

         prev = curr;
      }

      // Totals row
      const totalRow = document.createElement("tr");
      totalRow.innerHTML = `
         &lt;td style="font-weight:bold; color:red; text-align:left;">Total Distance&lt;/td>
         &lt;td>&lt;/td>
         &lt;td>&lt;/td>
         &lt;td style="font-weight:bold; color:red;">${totalOrtho.toFixed(2)}&lt;/td>
         &lt;td>&lt;/td>
         &lt;td style="font-weight:bold; color:red;">${totalLoxo.toFixed(2)}&lt;/td>`;
      tbody.appendChild(totalRow);

      copyText += `Total Distance\t\t\t${totalOrtho.toFixed(2)}\t\t${totalLoxo.toFixed(2)}\n`;

      table.appendChild(tbody);
      wrapper.appendChild(table);

      // Copy button
      const copyButton = document.createElement("button");
      copyButton.textContent = "Copy Table";
      copyButton.style.marginTop = "10px";
      copyButton.style.padding = "6px 12px";
      copyButton.style.border = "1px solid #999";
      copyButton.style.borderRadius = "4px";
      copyButton.style.backgroundColor = "#eee";
      copyButton.style.cursor = "pointer";
      copyButton.addEventListener("click", () => {
         navigator.clipboard.writeText(copyText).then(() => {
            Swal.fire({
               toast: true,
               position: 'top-end',
               icon: 'success',
               title: `Table copied for ${competitor.name}`,
               showConfirmButton: false,
               timer: 1500
            });
         });
      });

      wrapper.appendChild(copyButton);
      container.appendChild(wrapper);
   });

   Swal.fire({
      title: "Waypoint Distances",
       html: container,
      width: "90%",
      scrollbarPadding: false,
      confirmButtonText: "Close"
   });
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addMarker">addMarker</a></li><li><a href="global.html#addPOI">addPOI</a></li><li><a href="global.html#addWaypoint">addWaypoint</a></li><li><a href="global.html#aisData">aisData</a></li><li><a href="global.html#aisDump">aisDump</a></li><li><a href="global.html#aisLayer">aisLayer</a></li><li><a href="global.html#backWard">backWard</a></li><li><a href="global.html#bestVmg">bestVmg</a></li><li><a href="global.html#bestVmgBack">bestVmgBack</a></li><li><a href="global.html#buildBodyRequest">buildBodyRequest</a></li><li><a href="global.html#button4POI">button4POI</a></li><li><a href="global.html#changeParam">changeParam</a></li><li><a href="global.html#chooseFile">chooseFile</a></li><li><a href="global.html#chooseGrib">chooseGrib</a></li><li><a href="global.html#choosePolar">choosePolar</a></li><li><a href="global.html#clearRoutes">clearRoutes</a></li><li><a href="global.html#closeContextMenu">closeContextMenu</a></li><li><a href="global.html#condenseTimeStamps">condenseTimeStamps</a></li><li><a href="global.html#createProgressBar">createProgressBar</a></li><li><a href="global.html#dateToStr">dateToStr</a></li><li><a href="global.html#deleteAllPOIs">deleteAllPOIs</a></li><li><a href="global.html#deleteCompetitor">deleteCompetitor</a></li><li><a href="global.html#deleteCompetitorByName">deleteCompetitorByName</a></li><li><a href="global.html#deletePOI">deletePOI</a></li><li><a href="global.html#dispAllCompetitors">dispAllCompetitors</a></li><li><a href="global.html#dispBestTimeHistogram">dispBestTimeHistogram</a></li><li><a href="global.html#displayWayPoints">displayWayPoints</a></li><li><a href="global.html#dmsToDecimal">dmsToDecimal</a></li><li><a href="global.html#downloadTextFile">downloadTextFile</a></li><li><a href="global.html#drawGribLimits">drawGribLimits</a></li><li><a href="global.html#drawOrtho">drawOrtho</a></li><li><a href="global.html#drawPolyline">drawPolyline</a></li><li><a href="global.html#dumpFile">dumpFile</a></li><li><a href="global.html#dumpIsoDesc">dumpIsoDesc</a></li><li><a href="global.html#dumpIsoc">dumpIsoc</a></li><li><a href="global.html#dumpRoute">dumpRoute</a></li><li><a href="global.html#epochToStrDate">epochToStrDate</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#fPenalty">fPenalty</a></li><li><a href="global.html#fPointLoss">fPointLoss</a></li><li><a href="global.html#fTimeToRecupOnePoint">fTimeToRecupOnePoint</a></li><li><a href="global.html#feedback">feedback</a></li><li><a href="global.html#fetchAisPosition">fetchAisPosition</a></li><li><a href="global.html#fetchGpsPosition">fetchGpsPosition</a></li><li><a href="global.html#finalUpdate">finalUpdate</a></li><li><a href="global.html#findBounds">findBounds</a></li><li><a href="global.html#findMaxSpeed">findMaxSpeed</a></li><li><a href="global.html#forWard">forWard</a></li><li><a href="global.html#formatDuration">formatDuration</a></li><li><a href="global.html#formatDurationShort">formatDurationShort</a></li><li><a href="global.html#formatFileSize">formatFileSize</a></li><li><a href="global.html#formatLocalDate">formatLocalDate</a></li><li><a href="global.html#generatePolarPlotly">generatePolarPlotly</a></li><li><a href="global.html#getGreatCirclePath">getGreatCirclePath</a></li><li><a href="global.html#getLocalUtcOffsetInSeconds">getLocalUtcOffsetInSeconds</a></li><li><a href="global.html#getParam">getParam</a></li><li><a href="global.html#getSerializablePOIs">getSerializablePOIs</a></li><li><a href="global.html#getServerInit">getServerInit</a></li><li><a href="global.html#getTextColorFromLuminance">getTextColorFromLuminance</a></li><li><a href="global.html#goBegin">goBegin</a></li><li><a href="global.html#gpsMarker">gpsMarker</a></li><li><a href="global.html#gpsPolyline">gpsPolyline</a></li><li><a href="global.html#gpsTrack">gpsTrack</a></li><li><a href="global.html#gribInfo">gribInfo</a></li><li><a href="global.html#handleRequest">handleRequest</a></li><li><a href="global.html#helpInfo">helpInfo</a></li><li><a href="global.html#importCSV">importCSV</a></li><li><a href="global.html#interpolate">interpolate</a></li><li><a href="global.html#interpolateSpeeds">interpolateSpeeds</a></li><li><a href="global.html#lastStepDurationFormatted">lastStepDurationFormatted</a></li><li><a href="global.html#latLonToStr">latLonToStr</a></li><li><a href="global.html#launchRouting">launchRouting</a></li><li><a href="global.html#loadAppState">loadAppState</a></li><li><a href="global.html#loxoCap">loxoCap</a></li><li><a href="global.html#loxoDist">loxoDist</a></li><li><a href="global.html#manageCompetitors">manageCompetitors</a></li><li><a href="global.html#move">move</a></li><li><a href="global.html#newCompetitor">newCompetitor</a></li><li><a href="global.html#orthoCap">orthoCap</a></li><li><a href="global.html#orthoDist">orthoDist</a></li><li><a href="global.html#parDump">parDump</a></li><li><a href="global.html#polarInfo">polarInfo</a></li><li><a href="global.html#popup4Comp">popup4Comp</a></li><li><a href="global.html#refreshMarker">refreshMarker</a></li><li><a href="global.html#removeCompetitor">removeCompetitor</a></li><li><a href="global.html#replay">replay</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#requestAllCompetitors">requestAllCompetitors</a></li><li><a href="global.html#requestBestTime">requestBestTime</a></li><li><a href="global.html#requestOne">requestOne</a></li><li><a href="global.html#resetWaypoint">resetWaypoint</a></li><li><a href="global.html#saveAppState">saveAppState</a></li><li><a href="global.html#setBoat">setBoat</a></li><li><a href="global.html#showAIS">showAIS</a></li><li><a href="global.html#showBoatPosition">showBoatPosition</a></li><li><a href="global.html#showContextMenu">showContextMenu</a></li><li><a href="global.html#showDestination">showDestination</a></li><li><a href="global.html#showInitMessage">showInitMessage</a></li><li><a href="global.html#showPOI">showPOI</a></li><li><a href="global.html#showPolarTable">showPolarTable</a></li><li><a href="global.html#showRoute">showRoute</a></li><li><a href="global.html#showRouteReport">showRouteReport</a></li><li><a href="global.html#showWayPoint">showWayPoint</a></li><li><a href="global.html#simplify">simplify</a></li><li><a href="global.html#stamina">stamina</a></li><li><a href="global.html#statChanges">statChanges</a></li><li><a href="global.html#switchTab">switchTab</a></li><li><a href="global.html#symmetrizeData">symmetrizeData</a></li><li><a href="global.html#toDMSString">toDMSString</a></li><li><a href="global.html#updateAllBoats">updateAllBoats</a></li><li><a href="global.html#updateBindPopup">updateBindPopup</a></li><li><a href="global.html#updateBoatSelect">updateBoatSelect</a></li><li><a href="global.html#updateHeading">updateHeading</a></li><li><a href="global.html#updateIconStyle">updateIconStyle</a></li><li><a href="global.html#updateRouteDisplay">updateRouteDisplay</a></li><li><a href="global.html#updateStatusBar">updateStatusBar</a></li><li><a href="global.html#updateToolsVisibility">updateToolsVisibility</a></li><li><a href="global.html#updateWindyMap">updateWindyMap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue May 13 2025 23:41:58 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

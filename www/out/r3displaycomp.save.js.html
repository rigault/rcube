<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: r3displaycomp.save.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: r3displaycomp.save.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* jshint esversion: 6 */

/**
 * Updates the boat select dropdown dynamically after changes in competitors.
 */
function updateBoatSelect() {
   const boatSelect = document.getElementById("boatSelect");
   boatSelect.innerHTML = ""; // Clear existing options

   let boatNames = competitors.map(competitor => competitor[0]);

   let option = document.createElement("option");
   option.value = 0;
   option.textContent = (boatNames.length &lt;= 1) ? "" : "All";
   boatSelect.appendChild(option);

   boatNames.forEach((name, i) => {
      let option = document.createElement("option");
      option.value = i + 1;
      option.textContent = name;
      boatSelect.appendChild(option);
   });

   if (boatSelect.options.length > 1) {
      boatSelect.value = boatSelect.options[1].value;
   }
}

/**
 * Converts latitude and longitude to a formatted string in DMS format.
 * @param {number} lat - The latitude in decimal degrees.
 * @param {number} lon - The longitude in decimal degrees.
 * @returns {string} The formatted coordinate string.
 */
function latLonToStr(lat, lon) {
   function toDMS(deg, isLat) {
      const d = Math.floor(Math.abs(deg));
      const m = Math.floor((Math.abs(deg) - d) * 60);
      const s = Math.round((Math.abs(deg) - d - m / 60) * 3600);
      const dir = isLat ? (deg >= 0 ? 'N' : 'S') : (deg >= 0 ? 'E' : 'W');
      return `${d}°${m}&amp;apos;${s}" ${dir}`;
   }
   return `${toDMS(lat, true)} - ${toDMS(lon, false)}`;
}

/**
 * Displays a modal to manage a list of competitors, allowing editing, adding, and removing entries.
 * @param {Array} competitors - An array of competitors, where each entry is [name, lat, lon, colorIndex].
 */
async function manageCompetitors(competitors) {
   let palette = "&lt;div style='display: flex; align-items: center; gap: 10px; margin-left: 20px'>";
   colorMap.forEach((color, index) => {
      palette += `&lt;span style="display: flex; align-items: center; gap: 5px;">
                    &lt;div style="width: 10px; height: 10px; border-radius: 50%; background-color: ${color}; border: 1px solid #333;">&lt;/div>
                    ${index}
                  &lt;/span>`;
   });
   palette += "&lt;/div>";

   let html = `&lt;table style='width:100%; text-align:left; table-layout: auto;'>
               &lt;tr>&lt;th style='width:25%'>Name&lt;/th>&lt;th style='width:10%'>Col&lt;/th>&lt;th style='width:55%'>Coordinates&lt;/th>&lt;th style='width:10%'>Action&lt;/th>&lt;/tr>`;
   competitors.forEach((c, index) => {
      html += `&lt;tr>
               &lt;td>&lt;input type='text' style='width:100%' value='${c[0]}' id='name${index}'>&lt;/td>
               &lt;td>&lt;input type='number' style='width:100%' value='${c[3]}' id='color${index}'>&lt;/td>
               &lt;td>&lt;input type='text' style='width:100%; font-size:14px;' value='${latLonToStr(c[1], c[2])}' id='coord${index}'>&lt;/td>
               &lt;td>${competitors.length > 1 ? `&lt;button type='button' onclick='removeCompetitor(${index})'>❌&lt;/button>` : ''}&lt;/td>
            &lt;/tr>`;
   });
   html += `&lt;/table>`;
   html += palette;
   await Swal.fire({
      title: 'Manage Competitors',
      width: '800px',
      html: `&lt;div style='width: 100%; overflow-x: auto;'>${html}&lt;/div>`,
      showCancelButton: true,
      confirmButtonText: 'Save',
      denyButtonText: 'Add',
      showDenyButton: true, // display "Add" buuton
      preConfirm: () => {
         let updatedCompetitors = [];
         competitors.forEach((c, index) => {
            let name = document.getElementById(`name${index}`).value;
            let color = parseInt(document.getElementById(`color${index}`).value);
            let coords = document.getElementById(`coord${index}`).value;
            if (!coords.includes(' - ')) {
               Swal.showValidationMessage('Invalid coordinate format');
               return false;
            }
            let [latDMS, lonDMS] = coords.split(' - ');
            let lat = dmsToDecimal(latDMS.trim());
            let lon = dmsToDecimal(lonDMS.trim());
            updatedCompetitors.push([name, lat, lon, color]);
         });
         competitors.length = 0;
         competitors.push(...updatedCompetitors);
         updateBoatSelect();
         drawCompetitors(competitors);
      },
      preDeny: () => {
         addCompetitor(); // Ajoute un compétiteur lorsqu'on clique sur "Add"
         return false; // Empêche la fermeture de la boîte de dialogue
      }
   });
}
   
/**
 * Converts a coordinate in DMS format to decimal degrees.
 * @param {string} dms - The coordinate in DMS format (e.g., "46°24'33"N").
 * @returns {number} The decimal degrees equivalent of the DMS input.
 */
function dmsToDecimal(dms) {
   if (!dms) return 0;
   const parts = dms.match(/(\d+)\u00B0(\d+)'(\d+)\"\s*([NSEW])/);
   if (!parts) return 0;
   let [_, d, m, s, dir] = parts;
   let decimal = parseFloat(d) + parseFloat(m) / 60 + parseFloat(s) / 3600;
   if (dir === 'S' || dir === 'W') decimal *= -1;
   return decimal;
}

/**
 * Adds a new competitor with default values.
 */
function addCompetitor() {
    competitors.push([`New`, 0, 0, 0]);
    manageCompetitors(competitors);
}

/**
 * Removes a competitor from the list, ensuring at least one remains.
 * @param {number} index - The index of the competitor to remove.
 */
function removeCompetitor(index) {
    if (competitors.length > 1) {
        competitors.splice(index, 1);
        manageCompetitors(competitors);
    }
}

/**
 * Displays a table to compare competitors.
 * @param {Object} report - The dataset containing competitors information.
 */
function displayComp (route) {
   if (! route || ! ("_report" in route) || route ["_report"].array.length === 0) {
      Swal.fire({
         icon: 'warning',
         title: 'No competitor',
         text: 'No data available to compare',
      });
      return;
   }
   let report = route ["_report"];

   // Meta data build
   let metaData = `
      &lt;p>&lt;strong>Number of competitors:&lt;/strong> ${report.nComp}&lt;/p>
      &lt;p>&lt;strong>Start date and time:&lt;/strong> ${report.startTimeStr}&lt;/p>
      &lt;p>&lt;strong>Isochrone Time Step:&lt;/strong> ${report.isocTimeStep} sec&lt;/p>
      &lt;p>&lt;strong>Polar:&lt;/strong> ${report.polar}&lt;/p>
   `;

   // Comprtitors comparison table
   let table = `&lt;table class="comp-table">
      &lt;thead>
         &lt;tr>
            &lt;th>Name&lt;/th>
            &lt;th>Lat.&lt;/th>
            &lt;th>Lon.&lt;/th>
            &lt;th>Distance to Main&lt;/th>
            &lt;th>ETA&lt;/th>
            &lt;th>Distance done&lt;/th>
            &lt;th>Time to best&lt;/th>
            &lt;th>Time to main&lt;/th>
         &lt;/tr>
      &lt;/thead>
      &lt;tbody>
   `;
   
   report.array.forEach(comp => {
      table += `
         &lt;tr>
            &lt;td>${comp.name}&lt;/td>
            &lt;td>${comp.lat.toFixed(4)}&lt;/td>
            &lt;td>${comp.lon.toFixed(4)}&lt;/td>
            &lt;td>${comp.distToMain.toFixed(2)} NM&lt;/td>
            &lt;td>${comp.ETA}&lt;/td>
            &lt;td>${comp.distDone.toFixed(2)} NM&lt;/td>
            &lt;td>${comp.toBestDelay} sec&lt;/td>
            &lt;td>${comp.toMainDelay} sec&lt;/td>
         &lt;/tr>
      `;
   });
   
   table += `&lt;/tbody>&lt;/table>`;

   // Affichage avec SweetAlert2
   Swal.fire({
      title: 'Competitors benchmark',
      html: metaData + table,
      width: '80%',
      confirmButtonText: 'Close',
   });
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCompetitor">addCompetitor</a></li><li><a href="global.html#addMarker">addMarker</a></li><li><a href="global.html#addPOI">addPOI</a></li><li><a href="global.html#addWaypoint">addWaypoint</a></li><li><a href="global.html#backWard">backWard</a></li><li><a href="global.html#bestVmg">bestVmg</a></li><li><a href="global.html#bestVmgBack">bestVmgBack</a></li><li><a href="global.html#buildBodyRequest">buildBodyRequest</a></li><li><a href="global.html#changeParam">changeParam</a></li><li><a href="global.html#chooseGrib">chooseGrib</a></li><li><a href="global.html#choosePolar">choosePolar</a></li><li><a href="global.html#clearRoutes">clearRoutes</a></li><li><a href="global.html#closeContextMenu">closeContextMenu</a></li><li><a href="global.html#condenseTimeStamps">condenseTimeStamps</a></li><li><a href="global.html#deleteAllPOIs">deleteAllPOIs</a></li><li><a href="global.html#deletePOI">deletePOI</a></li><li><a href="global.html#displayBestTimeHistogram">displayBestTimeHistogram</a></li><li><a href="global.html#displayComp">displayComp</a></li><li><a href="global.html#displayWayPoints">displayWayPoints</a></li><li><a href="global.html#dmsToDecimal">dmsToDecimal</a></li><li><a href="global.html#drawGribLimits">drawGribLimits</a></li><li><a href="global.html#drawOrtho">drawOrtho</a></li><li><a href="global.html#drawPolyline">drawPolyline</a></li><li><a href="global.html#dumpRoute">dumpRoute</a></li><li><a href="global.html#feedback">feedback</a></li><li><a href="global.html#findBounds">findBounds</a></li><li><a href="global.html#findMaxSpeed">findMaxSpeed</a></li><li><a href="global.html#forWard">forWard</a></li><li><a href="global.html#formatDuration">formatDuration</a></li><li><a href="global.html#formatDurationShort">formatDurationShort</a></li><li><a href="global.html#formatLocalDate">formatLocalDate</a></li><li><a href="global.html#generatePolarPlotly">generatePolarPlotly</a></li><li><a href="global.html#getGreatCirclePath">getGreatCirclePath</a></li><li><a href="global.html#getParam">getParam</a></li><li><a href="global.html#getServerInit">getServerInit</a></li><li><a href="global.html#goBegin">goBegin</a></li><li><a href="global.html#gribInfo">gribInfo</a></li><li><a href="global.html#helpInfo">helpInfo</a></li><li><a href="global.html#interpolate">interpolate</a></li><li><a href="global.html#interpolateSpeeds">interpolateSpeeds</a></li><li><a href="global.html#latLonToStr">latLonToStr</a></li><li><a href="global.html#loadAppState">loadAppState</a></li><li><a href="global.html#loxoCap">loxoCap</a></li><li><a href="global.html#loxoDist">loxoDist</a></li><li><a href="global.html#manageCompetitors">manageCompetitors</a></li><li><a href="global.html#move">move</a></li><li><a href="global.html#oldshowContextMenu">oldshowContextMenu</a></li><li><a href="global.html#orthoCap">orthoCap</a></li><li><a href="global.html#orthoDist">orthoDist</a></li><li><a href="global.html#parDump">parDump</a></li><li><a href="global.html#polarInfo">polarInfo</a></li><li><a href="global.html#refreshMarker">refreshMarker</a></li><li><a href="global.html#removeCompetitor">removeCompetitor</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#resetWaypoint">resetWaypoint</a></li><li><a href="global.html#saveAppState">saveAppState</a></li><li><a href="global.html#setBoat">setBoat</a></li><li><a href="global.html#showContextMenu">showContextMenu</a></li><li><a href="global.html#showDestination">showDestination</a></li><li><a href="global.html#showInitMessage">showInitMessage</a></li><li><a href="global.html#showPOI">showPOI</a></li><li><a href="global.html#showPolarTable">showPolarTable</a></li><li><a href="global.html#showRoute">showRoute</a></li><li><a href="global.html#showRouteReport">showRouteReport</a></li><li><a href="global.html#showWayPoint">showWayPoint</a></li><li><a href="global.html#switchTab">switchTab</a></li><li><a href="global.html#symmetrizeData">symmetrizeData</a></li><li><a href="global.html#toDMSString">toDMSString</a></li><li><a href="global.html#updateAllBoats">updateAllBoats</a></li><li><a href="global.html#updateBindPopup">updateBindPopup</a></li><li><a href="global.html#updateBoatSelect">updateBoatSelect</a></li><li><a href="global.html#updateHeading">updateHeading</a></li><li><a href="global.html#updateIconStyle">updateIconStyle</a></li><li><a href="global.html#updateRouteDisplay">updateRouteDisplay</a></li><li><a href="global.html#updateStatusBar">updateStatusBar</a></li><li><a href="global.html#updateWindyMap">updateWindyMap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Mar 23 2025 22:11:09 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
